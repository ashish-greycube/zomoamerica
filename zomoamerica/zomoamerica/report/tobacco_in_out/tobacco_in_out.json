{
 "add_total_row": 0,
 "creation": "2019-10-23 09:45:15.658870",
 "disable_prepared_report": 0,
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "idx": 0,
 "is_standard": "Yes",
 "letter_head": "ZA - Standard NO TAX",
 "modified": "2019-10-23 09:47:15.991635",
 "modified_by": "Administrator",
 "module": "ZomoAmerica",
 "name": "Tobacco In Out",
 "owner": "Administrator",
 "prepared_report": 0,
 "query": "SELECT round(coalesce(max(OpeningBalance),0)*2.20462,2) AS \"OpeningBalance:Data:150\",\r\n\t\tround(coalesce(max(Purchase),0)*2.20462,2)as \"Purchase:Data:120\",\r\n\t\tround(coalesce(max(Sales),0)*2.20462,2) as \"Sales:Data:120\",\r\n\t\tround(coalesce(max(ClosingBalance),0)*2.20462,2) as \"ClosingBalance:Data:150\",\r\n\t\tround(coalesce((max(OpeningBalance) + max(Purchase) -max(Sales) - max(ClosingBalance)),0)*2.20462,2) as \"Discripancy:Data:120\"\r\nfrom(\r\nselect \tsum(OpeningWeigth) AS OpeningBalance,\r\n\t\t\t0 AS Purchase,\r\n\t\t\t0 AS Sales,\r\n\t\t\t0 AS ClosingBalance\r\n\t\t\tfrom \r\n(SELECT CASE sle.stock_uom \r\n\t\t\tWHEN 'BOX' THEN SUM(0.25*actual_qty)\r\n\t\t\tWHEN 'MASTER CASE' THEN SUM(6*actual_qty)\r\n\t\t\tWHEN 'CARTON' THEN SUM(actual_qty*0.5)\r\n\t\t\tELSE 0 \r\n\t\t\tEND AS OpeningWeigth\r\n\t\tFROM `tabStock Ledger Entry` sle\r\n\t\tINNER JOIN `tabItem` AS TI \r\n\t\tON sle.item_code = TI.item_code\r\n\t\tWHERE posting_date < %(from_date)s\r\n\t\tAND TI.item_group in (select distinct name from `tabItem Group` where parent_item_group = 'TOBACCO')\r\n\t\tgroup by sle.stock_uom ) as OW\t\t\r\nUNION ALL \r\nselect \r\n0 as OpeningBalance,\r\nsum(round(coalesce(item.total_weight,0),2)) as Purchase,\r\n0 as Sales,\r\n0 as ClosingBalance\r\nfrom `tabPurchase Receipt` si\r\nleft outer join (SELECT sum(total_weight)as total_weight, parent from (select CASE weight_uom\r\n\t\t\t\t\t\tWHEN 'Gram' then sum(total_weight/1000)\r\n\t\t\t\t\t\tELSE sum(total_weight)\r\n\t\t\t\t\t\tEND as total_weight,\r\n\t\t\t\t\t\tparent from `tabPurchase Receipt Item` \r\n\t\t\t\t\t\twhere item_group in (select distinct name from `tabItem Group` where parent_item_group = 'TOBACCO') group by parent,weight_uom) as t group by parent) item on item.parent=si.name\r\nWHERE si.docstatus=1  \r\nand si.name in (select distinct parent from `tabPurchase Receipt Item` where item_group in \r\n(select distinct name from `tabItem Group` where parent_item_group = 'TOBACCO'))\r\nAND si.posting_date >= %(from_date)s and si.posting_date <= %(to_date)s\r\nUNION ALL\r\nselect \r\n0 as OpeningBalance,\r\n0 as Purchase,\r\n(MAX(Sales)+ MAX(delivery))as Sales,\r\n0 as ClosingBalance\r\nFROM\r\n( select  -- SALES INVOICE\r\nsum(round(coalesce(item.total_weight,0),2)) as Sales,\r\n0 as delivery\r\nfrom `tabSales Invoice` si\r\nleft outer join (SELECT sum(total_weight)as total_weight, parent from (select CASE weight_uom\r\n\t\t\t\t\t\tWHEN 'Gram' then sum(total_weight/1000)\r\n\t\t\t\t\t\tELSE sum(total_weight)\r\n\t\t\t\t\t\tEND as total_weight,\r\n\t\t\t\t\t\tparent from `tabSales Invoice Item` \r\n\t\t\t\t\t\twhere item_group in (select distinct name from `tabItem Group` where parent_item_group = 'TOBACCO') group by parent,weight_uom) as t group by parent) item on item.parent=si.name\r\nWHERE si.docstatus=1 and si.update_stock = 1\r\nand si.name in (select distinct parent from `tabSales Invoice Item` where item_group in \r\n(select distinct name from `tabItem Group` where parent_item_group = 'TOBACCO'))\r\nAND si.posting_date >= %(from_date)s and si.posting_date <= %(to_date)s\r\nUNION ALL -- DELIVERY NOTE\r\nselect \r\n0 as Sales,\r\n sum(round(coalesce(item.total_weight,0),2)) as Delivery\r\nfrom `tabDelivery Note` si\r\nleft outer join (SELECT sum(total_weight)as total_weight, parent from (select CASE weight_uom\r\n\t\t\t\t\t\tWHEN 'Gram' then sum(total_weight/1000)\r\n\t\t\t\t\t\tELSE sum(total_weight)\r\n\t\t\t\t\t\tEND as total_weight,\r\n\t\t\t\t\t\tparent from `tabDelivery Note Item` \r\n\t\t\t\t\t\twhere item_group in (select distinct name from `tabItem Group` where parent_item_group = 'TOBACCO') group by parent,weight_uom) as t group by parent) item on item.parent=si.name\r\nWHERE si.docstatus=1 \r\nand si.name in (select distinct parent from `tabDelivery Note Item` where item_group in \r\n(select distinct name from `tabItem Group` where parent_item_group = 'TOBACCO'))\r\nAND si.posting_date >= %(from_date)s and si.posting_date <= %(to_date)s\r\n) as D\r\nUNION ALL\r\nSELECT \t0 AS OpeningBalance,\r\n\t\t0 AS Purchase,\r\n\t\t0 AS Sales,\t\t \r\n\t\tSUM(ClosingWeigth) AS ClosingBalance\r\n\t\tfrom ( \r\n\t\tSELECT\r\n\t\tCASE sle.stock_uom \r\n\t\t\tWHEN 'BOX' THEN sum(0.25*actual_qty)\r\n\t\t\tWHEN 'MASTER CASE' THEN sum(6*actual_qty)\r\n\t\t\tWHEN 'CARTON' THEN SUM(actual_qty*0.5)\r\n\t\t\tELSE 0\r\n\t\t\tEND  AS ClosingWeigth\r\n\t\tFROM `tabStock Ledger Entry` sle\r\n\t\tINNER JOIN `tabItem` AS TI \r\n\t\tON sle.item_code = TI.item_code\r\n\t\tWHERE posting_date <= %(to_date)s\r\n\t\tAND TI.item_group in (select distinct name from `tabItem Group` where parent_item_group = 'TOBACCO')\r\n\t\tgroup by sle.stock_uom) as CW\r\n\t) as finaloutput",
 "ref_doctype": "Stock Ledger Entry",
 "report_name": "Tobacco In Out",
 "report_type": "Query Report",
 "roles": [
  {
   "role": "Stock User"
  },
  {
   "role": "Accounts Manager"
  }
 ]
}